<html>
    <head>
        <title>Expense Manager</title>
        <link rel="stylesheet" type="text/css" href="style/iframe.css"> 
        <link rel="stylesheet" type="text/css" href="style/horizontalNav.css">

        <?php
        session_start();
        if (isset($_SESSION['loggedin']) && $_SESSION['loggedin'] == true) {
            //echo "Welcome to the member's area, " . $_SESSION['username'] . "!";
        } else {
            //echo "Please log in first to see this page.";
            header("Location: ./login"); 
        }
        ?>

        <script language="javascript" type="text/javascript" src="js/jquery-1.11.3.min.js"></script>
        <script language="javascript" type="text/javascript">
            function saveEntries() {
                var curselMonth = document.getElementById("frame1").contentWindow.selMonth;
                var curselYear =  document.getElementById("frame1").contentWindow.selYear;
                var mainWinHref = document.getElementById("frame2").contentWindow.location.href;
                var data = "";

                if (mainWinHref.indexOf("monthlyEntry.html") > -1)  {
                    if ((curselMonth >= 1 && curselMonth <= 12) &&
                        (curselYear >= 1979 && curselYear <= 9999)) {
                        var table = $("#frame2").contents().find("tbody")[0]; 
                        for (var i = 0, row; row = table.rows[i]; i++) {
                           data += "@"; 
                           for (var j = 0, col; col = row.cells[j]; j++) {
                               switch (j)  {
                                   // date
                                   case 0: 
                                   if (isNaN(Date.parse(col.childNodes[0].value)) == true)
                                        data += "edate="+curselYear+"-"+curselMonth+"-"+"01";
                                   else data += "edate=" + col.childNodes[0].value; 
                                   break;
                                   // category
                                   case 1:
                                   if (col.childNodes[0].value == '')  data += "?category=0";
                                   else data += "?category=" + col.childNodes[0].value; 
                                   break;
                                   // description
                                   case 2:
                                   if (col.childNodes[0].value == '') data += "?description=--Empty--"; 
                                   else data += "?description=" + col.childNodes[0].value; 
                                   break;
                                   // amount
                                   case 3:
                                   if (col.childNodes[0].value == '') data += "?amount=0";
                                   else data += "?amount=" + col.childNodes[0].value; 
                                   break;
                                   default: break;
                               }
                           } 
                        }

                        if (curselMonth < 10) curselMonth = "0" + curselMonth;        
                        $.get("./php/setTableRows.php", {month: curselMonth, 
                                                     year: curselYear, 
                                                     rowEntries: data}).
                              done(function(ret_status) {
                            alert (ret_status);
                        })
                    } else {
                        alert ("Please select a month for saving !");
                    }
                }
            }

            function monthlySummary ()  {
                var curselMonth = document.getElementById("frame1").contentWindow.selMonth;
                var curselYear =  document.getElementById("frame1").contentWindow.selYear;

                if ((curselMonth >= 1 && curselMonth <= 12) &&
                    (curselYear >= 1979 && curselYear <= 9999)) {
                    document.getElementById('frame2').src = "summary";
                }
            }

            function yearlyReport () {
                var curselYear =  document.getElementById("frame1").contentWindow.selYear;

                if (curselYear >= 1979 && curselYear <= 9999) {
                    document.getElementById('frame2').src = "report";
                }
            }
        </script>
    </head>

    <body>
        <!-- Create hyperlinks to Horizontal Navigation bar  -->
        <ul>
            <li><a class="highlightColor" href="">Happy Home</a></li>
            <li><a href="javascript:void(0);" 
                   onclick="javascript:saveEntries();">Save</a></li>
            <li><a href="javascript:void(0);"
                   onclick="javascript:yearlyReport();">Report</a></li>
            <li><a href="javascript:void(0);">Download</a></li>
            <li><a href="javascript:void(0);" 
                   onclick="javascript:monthlySummary();">Summary</a></li>
            <ul class="dropdown" style="float:right;list-style-type:none;">
                <li>
                    <a href="javascript:void(0);"><?= ucfirst($_SESSION['username']) ?> &#9662;</a>
                    <ul class="dropdown">
                        <li><a href="php/usrLogout.php">Logout</a></li>
                    </ul>
                </li>
            </ul>
        </ul>

        <!-- Create frame for vertical navigation bar and main window  -->
        <iframe id="frame1" name="frame1" class="menu" src="verticalNav.html" frameborder="0">
            <p>Your browser does not support iframes.</p>
        </iframe>
        <iframe id="frame2" name="frame2" class="mainContent" src="welcome.html" frameborder="0">
            <p>Your browser does not support iframes.</p>
        </iframe>
    </body>
</html>
