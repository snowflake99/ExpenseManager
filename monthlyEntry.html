<!DOCTYPE html>
<html>
    <head>
    <style>
        table {
            -moz-box-shadow: 0 0 5px #888;
            -webkit-box-shadow: 0 0 5px#888;
            box-shadow: 0 0 5px #888;
        }
    </style>
    <link rel="stylesheet" type="text/css" href="style/roundButton.css">

    <script language="javascript" type="text/javascript" src="js/jquery-1.11.3.min.js"></script>

    <?php
    session_start();
    if (isset($_SESSION['loggedin']) && $_SESSION['loggedin'] == true) {
        //echo "Welcome to the member's area, " . $_SESSION['username'] . "!";
    } else {
        //echo "Please log in first to see this page.";
        header("Location: ./login"); 
    }
    ?>

        
    <script language="javascript" type="text/javascript">
        // Global variable used to create unique row elements id
        var idx = 0;

        function deleteRow(rowIdNum)    {
            var rowRef = document.getElementById('row'+rowIdNum);
            var numRows = document.getElementById("expenseTable").rows.length;;
    
            if (numRows > 2)    {
	        // Delete the row and show '+' in last row element
                document.getElementById("expenseTable").deleteRow(rowRef.rowIndex);
                $('#expenseTable tr:last')[0].childNodes[5].style.visibility="visible";
            }
        }

        function addRow(dates) {
            var table  = $("#expenseTable");
            var tBody  = table.find("tbody");
            var rowCount = document.getElementById("expenseTable").rows.length;

            tBody.append(
            '<tr id="row'+idx+'">'+
            '<td><input type="date" name="Date'+idx+'" id="Date'+idx+'" class="Date" value="'+dates[0]+'"></td>'+
            '<td>'+
              '<select name="Category'+idx+'" id="Category'+idx+'">'+
                 '<option value="">Please select</option>'+
                 '<option value="1">Home</option>'+
                 '<option value="2">Conveyance</option>'+
                 '<option value="3">Groceries</option>'+
                 '<option value="4">Gifts</option>'+
                 '<option value="5">Shopping</option>'+
                 '<option value="6">Miscellaneous</option>'+
                 '<option value="7">Cigarette</option>'+
                 '<option value="8">Bills</option>'+
                 '<option value="9">Food</option>'+
              '</select>'+
            '</td>'+
            '<td><input name="Description'+idx+'" id="Description'+idx+'"></td>'+
            '<td><input name="Amount'+idx+'" id="Amount'+idx+'"></td>'+
            '<td><div name="neg'+idx+'" id="neg'+idx+'" class="round-button"><div class="round-button-circle"><a href="javascript:deleteRow('+idx+');" class="round-button">-</a></div></div></td>'+
            '<td><div name="pos'+idx+'" id="pos'+idx+'"  class="round-button"><div class="round-button-circle"><a href="javascript:addRow('+dates+');" class="round-button">+</a></div></div></td>'+
            '</tr>');
            $('#Date'+idx)[0].style.width='140px';
            $('#Date'+idx)[0].style.textAlign='center';

            $('#Description'+idx)[0].style.width='500px';
            $('#Description'+idx)[0].textAlign='right';

            $('#Amount'+idx)[0].style.width='80px';
            $('#Amount'+idx)[0].style.textAlign='center';

            // Hide the + button in previous row
            if (rowCount > 1) {
                $('#expenseTable tr:last').prev()[0].childNodes[5].style.visibility="hidden";
            }

            idx++;
        }

        function getUrlVars() {
            var vars = {};
            var parts = window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi, function(m,key,value) {vars[key] = value;});
            return vars;
        }

        $(function() {
            var curselMonth = getUrlVars()["sel"];
            var dateTemplate = Array(); 
    
            if (curselMonth < 10)
                curselMonth = '0'+curselMonth;
            dateTemplate.push('2015-'+curselMonth+'-01');

            addRow(dateTemplate);

            // TODO: Test connection of mysql DB
            $.get("./php/mysql_connect.php", {name: 'sanjoy', password: 'sanjoy'}).done(function(data) {
                //var currDates = data['Date'];
                //addRow(currDates);
                console.log (data);
                //console.log (currDates);
            });
        });
    </script> 
    </head>
    <body>
        <form>
            <table name="expenseTable" id="expenseTable" align="center"  bgcolor="#f1f1f1">
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Category</th>
                        <th>Description</th>
                        <th>Amount</th>
                    </tr>
                </thead>
                <tbody>
                </tbody>
            </table>
        </form>
    </body>
</html>
