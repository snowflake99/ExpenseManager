<!DOCTYPE html>
<html>
    <head>
    <style>
        table {
            -moz-box-shadow: 0 0 5px #888;
            -webkit-box-shadow: 0 0 5px#888;
            box-shadow: 0 0 5px #888;
        }
    </style>
    <script language="javascript" type="text/javascript" src="js/jquery-1.11.3.min.js"></script>
    <?php
    session_start();
    if (isset($_SESSION['loggedin']) && $_SESSION['loggedin'] == true) {
        //echo "Welcome to the member's area, " . $_SESSION['username'] . "!";
    } else {
        //echo "Please log in first to see this page.";
        header("Location: ./login"); 
    }
    ?>

    <script language="javascript" type="text/javascript">
        function daysInMonth(year, month) { 
            var monthLength = new Date(year,month,0).getDate();
            var ret = new Array();
            var mm = (month < 10) ? ('0' + month) : month;

            for (var i = 1; i <= monthLength; i++) {
                var dd = (i < 10) ? ('0' + i) : i;
                ret.push(dd + '/' + mm + '/' + year);
            }
            
            return ret;
        };

        function addRows(table, dates) {
            var idx = 1;
            for (var i in dates) {
                table.append(
                '<tr>'+
                '<td><input name="Date'+idx+'" id="Date'+idx+'" class="Date" value="'+dates[i]+'"></td>'+
                '<td>'+
                  '<select name="Category'+idx+'" id="Category'+idx+'">'+
                     '<option value="">Please select</option>'+
                     '<option value="1">Home</option>'+
                     '<option value="2">Conveyance</option>'+
                     '<option value="3">Groceries</option>'+
                     '<option value="4">Gifts</option>'+
                     '<option value="5">Shopping</option>'+
                     '<option value="6">Miscellaneous</option>'+
                     '<option value="7">Cigarette</option>'+
                     '<option value="8">Bills</option>'+
                     '<option value="9">Food</option>'+
                  '</select>'+
                '</td>'+
                '<td><input name="Description'+idx+'" id="Description'+idx+'"></td>'+
                '<td><input name="Amount'+idx+'" id="Amount'+idx+'"></td>'+
                '</tr>');
                $('#Date'+idx)[0].style.width='80px';
                $('#Date'+idx)[0].style.textAlign='center';

                $('#Description'+idx)[0].style.width='500px';
                $('#Description'+idx)[0].textAlign='right';

                $('#Amount'+idx)[0].style.width='80px';
                $('#Amount'+idx)[0].style.textAlign='center';
                idx++;
            }
        }

        function getUrlVars() {
            var vars = {};
            var parts = window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi, function(m,key,value) {vars[key] = value;});
            return vars;
        }

        $(function() {
            var curselMonth = getUrlVars()["sel"];
            var todaysDate = new Date();
            var year   = todaysDate.getFullYear();
            var month  = curselMonth;
            var dates  = daysInMonth(year, month);
            var table  = $("#expenseTable");
            var tBody  = table.find("tbody");
            addRows(tBody, dates);

        // TODO: Test connection of mysql DB
        $.get("./php/mysql_connect.php", {name: 'sanjoy', password: 'sanjoy'}).done(function(data) {
        //var currDates = data['Date'];
        //addRows(tBody, currDates);
        console.log (data);
        //console.log (currDates);
        });
        });
    </script>       
    </head>
    <body>
        <form>
            <table id="expenseTable" align="center"  bgcolor="#f1f1f1">
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Category</th>
                        <th>Description</th>
                        <th>Amount</th>
                    </tr>
                </thead>
                <tbody>
                </tbody>
            </table>
        </form>
    </body>
</html>
